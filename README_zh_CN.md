# ä¸€ä¸ªMCPæœåŠ¡ç«¯æ’ä»¶

> ä¸º[æ€æºç¬”è®°](https://github.com/siyuan-note/siyuan)æä¾›MCPæœåŠ¡çš„æ’ä»¶ã€‚

> å½“å‰ç‰ˆæœ¬: v0.7.0
>
> æ–°å¢ï¼šCloudflare Access è®¤è¯æ”¯æŒï¼Œæ”¯æŒé€šè¿‡ Cloudflare Tunnel å®‰å…¨æš´éœ² MCP æœåŠ¡ï¼›
>
> å…¶ä»–è¯¦è§[æ›´æ–°æ—¥å¿—](./CHANGELOG.md)ã€‚

## âœ¨å¿«é€Ÿå¼€å§‹

- ä»é›†å¸‚ä¸‹è½½ æˆ– 1ã€è§£å‹Releaseä¸­çš„`package.zip`ï¼Œ2ã€å°†æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°`å·¥ä½œç©ºé—´/data/plugins/`ï¼Œ3ã€å¹¶å°†æ–‡ä»¶å¤¹é‡å‘½åä¸º`syplugin-anMCPServer`;
- å¼€å¯æ’ä»¶ï¼›
- æ‰“å¼€æ’ä»¶è®¾ç½®ï¼Œå¯åŠ¨æœåŠ¡ï¼›
- æ’ä»¶é»˜è®¤ç›‘å¬`16806`ç«¯å£ï¼ˆHost: `127.0.0.1`ï¼‰ï¼Œè¯·ä½¿ç”¨`http://127.0.0.1:16806/mcp`ä½œä¸ºæœåŠ¡ç«¯è®¿é—®åœ°å€ï¼›

> â­ å¦‚æœè¿™å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç‚¹äº®Starï¼

## ğŸ”§æ”¯æŒçš„å·¥å…·

- ã€æ£€ç´¢ã€‘
  - ~~ä½¿ç”¨å…³é”®è¯æœç´¢ï¼›~~  
    > ç›®å‰æ¥çœ‹ï¼Œåœ¨éœ€è¦SQLåŠ¨æ€æ£€ç´¢æ—¶ï¼Œå¤§æ¨¡å‹ä»ç„¶ä½¿ç”¨æ­¤å·¥å…·ã€‚æš‚æ—¶ç§»é™¤ï¼Œå¦‚æœ‰éœ€è¦è¯·åé¦ˆ
  - ä½¿ç”¨SQLæœç´¢ï¼›
  - ~~ç¬”è®°ç´¢å¼•åº“é—®ç­”ï¼ˆä½¿ç”¨RAGåç«¯æœåŠ¡ï¼Œ[åŠŸèƒ½æµ‹è¯•ä¸­](./RAG_BETA.md)ï¼‰ï¼›~~ 
    > æ­¤åŠŸèƒ½å³å°†è¢«ç§»é™¤ï¼Œåç»­å°†ä½¿ç”¨å…¶ä»–æ–¹æ¡ˆå®ç°ã€‚
- ã€è·å–ã€‘
  - é€šè¿‡idè·å–æ–‡æ¡£markdownï¼›
  - é€šè¿‡idè·å–å—kramdownï¼›
  - åˆ—å‡ºç¬”è®°æœ¬ï¼›
  - é€šè¿‡idè·å–åå‘é“¾æ¥ï¼›
  - è·å–æ–‡æ¡£çš„å­æ–‡æ¡£åˆ—è¡¨ï¼›
  - è¯»å–å±æ€§ï¼›
  - ~~è¯»å–æŒ‡å®šæ—¥æœŸæ—¥è®°ï¼›~~ 
    > æš‚æ—¶ç§»é™¤ï¼Œå¦‚æœ‰éœ€è¦è¯·åé¦ˆ
- ã€å†™å…¥ã€‘
  - æ–‡æ¡£ç±»
    - å‘æ—¥è®°è¿½åŠ å†…å®¹ï¼›
    - é€šè¿‡idå‘æŒ‡å®šæ–‡æ¡£è¿½åŠ å†…å®¹ï¼›
    - é€šè¿‡idåœ¨æŒ‡å®šä½ç½®åˆ›å»ºæ–°æ–‡æ¡£ï¼›
    - æ’å…¥å­å—ï¼›ï¼ˆå‰ç½®æ’å…¥/åç½®æ’å…¥ï¼‰
    - æ’å…¥å—ï¼›ï¼ˆæŒ‡å®šä½ç½®ï¼‰
    - æ›´æ–°å—ï¼›
  - é—ªå¡ç±»
    - é€šè¿‡Markdownå†…å®¹åˆ›å»ºé—ªå¡ï¼›
    - é€šè¿‡å—idåˆ›å»ºé—ªå¡ï¼›
    - é€šè¿‡å—idåˆ é™¤é—ªå¡ï¼›
  - å±æ€§
    - æ›´æ”¹å±æ€§ï¼›ï¼ˆå¢åˆ æ”¹ï¼‰


## â“å¯èƒ½å¸¸è§çš„é—®é¢˜

- Q: å¦‚ä½•åœ¨MCPå®¢æˆ·ç«¯ä¸­ä½¿ç”¨ï¼Ÿ
  è¯·å‚è€ƒåæ–‡ï¼›
- Q: å¸¸è§çš„MCPå®¢æˆ·ç«¯æœ‰å“ªäº›ï¼Ÿ
  - è¯·å‚è€ƒï¼šhttps://github.com/punkpeye/awesome-mcp-clients æˆ– https://modelcontextprotocol.io/clients ï¼›
- Qï¼šæ’ä»¶æ”¯æŒé‰´æƒå—ï¼Ÿ
  - v0.2.0ç‰ˆæœ¬å·²æ”¯æŒé‰´æƒï¼Œåœ¨æ’ä»¶è®¾ç½®å¤„è®¾ç½®é‰´æƒtokenåï¼Œåœ¨MCPå®¢æˆ·ç«¯ï¼Œéœ€è¦è®¾ç½®`authorization`è¯·æ±‚å¤´ï¼Œå…¶å€¼ä¸º `Bearer ä½ çš„Token`ï¼›
  - v0.7.0ç‰ˆæœ¬æ–°å¢ Cloudflare Access è®¤è¯æ”¯æŒï¼Œè¯¦è§ä¸‹æ–‡ [Cloudflare Access è®¤è¯](#cloudflare-access-è®¤è¯) ç« èŠ‚ï¼›
- Q: å¯ä»¥åœ¨dockerä½¿ç”¨å—ï¼Ÿ
  - ä¸å¯ä»¥ï¼Œæ’ä»¶ä¾èµ–nodejsç¯å¢ƒï¼Œä¸æ”¯æŒåœ¨ç§»åŠ¨ç«¯ã€dockerè¿è¡Œï¼›
  
    > è‹¥è¦æ”¯æŒdockerä¸­éƒ¨ç½²çš„æ€æºï¼Œå»ºè®®è½¬ä¸ºä½¿ç”¨å…¶ä»–MCPé¡¹ç›®ï¼Œéƒ¨åˆ†é¡¹ç›®å¯èƒ½åœ¨[è¿™é‡Œ](https://github.com/siyuan-note/siyuan/issues/13795)åˆ—å‡ºï¼›
    > 
    > æˆ–è€…ï¼Œä¿®æ”¹ä»£ç ï¼Œå°†æœ¬æ’ä»¶å’Œæ€æºå‰ç«¯è§£è€¦ï¼›
- Q: å¦‚ä½•æŸ¥çœ‹å·²ç»è®¾ç½®çš„æˆæƒç ï¼Ÿ
  - æˆæƒç å“ˆå¸Œåä¿å­˜ï¼Œåªèƒ½ä¿®æ”¹ï¼Œä¸èƒ½æŸ¥çœ‹ç”Ÿæ•ˆä¸­çš„æˆæƒç ï¼›
- Qï¼šä»€ä¹ˆæ˜¯â€œç¬”è®°ç´¢å¼•åº“é—®ç­”ï¼ˆä½¿ç”¨RAGåç«¯æœåŠ¡ï¼‰â€å·¥å…·ï¼Ÿ
  - â€œç¬”è®°ç´¢å¼•åº“é—®ç­”â€æ˜¯ä¸€ç§åŸºäº RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯çš„é—®ç­”å·¥å…·ã€‚è¯¥å·¥å…·å…è®¸è¯­è¨€æ¨¡å‹åœ¨å›ç­”é—®é¢˜æ—¶ï¼Œå¼•ç”¨å·²è¢«ç´¢å¼•çš„ç¬”è®°å†…å®¹ï¼Œç¡®ä¿ç”Ÿæˆçš„å›ç­”æ›´åŠ å‡†ç¡®ï¼›
  - å‚è€ƒ[RAG_BETAæ–‡æ¡£](./RAG_BETA.md)æ­£ç¡®éƒ¨ç½²å¹¶åœ¨æ’ä»¶è®¾ç½® â€œæ’ä»¶RAGåç«¯ï¼šè¯·æ±‚baseURLâ€ ä¹‹åï¼Œå¯ä»¥åœ¨æ–‡æ¡£æ ‘å³é”®-æ’ä»¶é€‰æ‹©ç´¢å¼•æ–‡æ¡£ï¼Œæ–‡æ¡£å°†å‘é€åˆ° RAGåç«¯ è¿›è¡Œç´¢å¼•ï¼ˆç›®å‰çš„å®ç°ä½¿ç”¨å¯¹ [LightRAG](https://github.com/HKUDS/LightRAG) ç®€å•åŒ…è£…çš„pythonåç«¯ï¼‰ï¼›
  - è¯­è¨€æ¨¡å‹åœ¨ç”¨æˆ·æé—®æ—¶ï¼Œå¯ä»¥è°ƒç”¨è¯¥å·¥å…·ï¼Œè·å–åŸºäº LightRAG çŸ¥è¯†å›¾è°±ç»™å‡ºçš„å›ç­”ï¼›
  - æ³¨æ„ï¼šå›ç­”ä»…åŸºäºå·²è¢«ç´¢å¼•çš„æ–‡æ¡£ï¼Œä¸ä¼šä½¿ç”¨æœªè¢«ç´¢å¼•çš„æ–‡æ¡£å†…å®¹ã€‚

## âœ…å¦‚ä½•åœ¨MCPå®¢æˆ·ç«¯ä¸­é…ç½®ï¼Ÿ

> MCPå®¢æˆ·ç«¯ä¸æ–­è¿­ä»£æ›´æ–°ï¼Œè¿™é‡Œçš„é…ç½®æˆ–ä½¿ç”¨è¯´æ˜æœªå¿…èƒ½å¤Ÿç›´æ¥å¥—ç”¨ï¼Œä»…ä¾›å‚è€ƒï¼›
>
> è¿™é‡Œå‡è®¾ï¼šæ’ä»¶è®¾ç½®çš„ç«¯å£å·ä¸º `16806`ï¼Œæˆæƒç ä¸º `abcdefg`ï¼Œè¯·ä»¥å®é™…å¡«å†™çš„æ’ä»¶è®¾ç½®ä¸ºå‡†ã€‚

ä¿®æ”¹MCPåº”ç”¨çš„é…ç½®ï¼Œé€‰æ‹©`Streamable HTTP`ç±»å‹ï¼Œå¹¶é…ç½®ç«¯ç‚¹ã€‚

### æ”¯æŒStreamable HTTPç±»å‹çš„å®¢æˆ·ç«¯

ä¸‹é¢çš„é…ç½®ä»¥ [Cherry Studio](https://github.com/CherryHQ/cherry-studio) ä¸ºä¾‹ï¼Œé’ˆå¯¹ä¸åŒçš„MCPå®¢æˆ·ç«¯ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„é…ç½®æ ¼å¼ï¼Œè¯·ä»¥MCPå®¢æˆ·ç«¯æ–‡æ¡£ä¸ºå‡†ã€‚

**æ’ä»¶æœªè®¾ç½®æˆæƒç **

1. ç±»å‹ï¼šé€‰æ‹© å¯æµå¼ä¼ è¾“çš„HTTPï¼ˆstreamablehttpï¼‰ï¼›
2. URLï¼š`http://127.0.0.1:16806/mcp`ï¼›
3. è¯·æ±‚å¤´ï¼šç©ºï¼›

**æ’ä»¶å·²è®¾ç½®æˆæƒç **

1. ç±»å‹ï¼šé€‰æ‹© å¯æµå¼ä¼ è¾“çš„HTTPï¼ˆstreamablehttpï¼‰ï¼›
2. URLï¼š`http://127.0.0.1:16806/mcp`ï¼›
3. è¯·æ±‚å¤´ï¼š`Authorization=Bearer abcedfg`ï¼›

> è¿™é‡Œå‡è®¾ï¼šæ’ä»¶è®¾ç½®çš„ç«¯å£å·ä¸º `16806`ï¼Œæˆæƒç ä¸º `abcdefg`ï¼Œè¯·ä»¥å®é™…å¡«å†™çš„æ’ä»¶è®¾ç½®ä¸ºå‡†ã€‚

### ä»…æ”¯æŒstdioçš„å®¢æˆ·ç«¯

è‹¥MCPå®¢æˆ·ç«¯ä¸æ”¯æŒåŸºäºHTTPçš„é€šä¿¡æ–¹å¼ï¼Œä»…æ”¯æŒstdioï¼Œåˆ™éœ€è¦é€šè¿‡è½¬æ¢åä½¿ç”¨ã€‚

è¿™é‡Œä½¿ç”¨`node.js` + `mcp-remote@next`çš„æ–¹æ¡ˆã€‚

1. ä¸‹è½½nodejs https://nodejs.org/zh-cn/download

2. å®‰è£…mcp-remote@next
  ```bash
  npm install -g mcp-remote@next
  ```

ä¸‹é¢çš„é…ç½®ä»¥ [5ire](https://5ire.app/) ä¸ºä¾‹ï¼Œé’ˆå¯¹ä¸åŒçš„MCPå®¢æˆ·ç«¯ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„é…ç½®æ ¼å¼ï¼Œè¯·ä»¥MCPå®¢æˆ·ç«¯æ–‡æ¡£ä¸ºå‡†ã€‚

**æ’ä»¶æœªè®¾ç½®æˆæƒç **

å‘½ä»¤ï¼š

```
npx mcp-remote@next http://127.0.0.1:16806/mcp
```

**æ’ä»¶å·²è®¾ç½®æˆæƒç **

å‘½ä»¤ï¼š
```
npx mcp-remote@next http://127.0.0.1:16806/mcp --header Authorization:${AUTH_HEADER}
```

ç¯å¢ƒå˜é‡ï¼š

åç§°ï¼š`AUTH_HEADER`
å€¼ï¼š`Bearer abcdefg`

> è¿™é‡Œå‡è®¾ï¼šæ’ä»¶è®¾ç½®çš„ç«¯å£å·ä¸º `16806`ï¼Œæˆæƒç ä¸º `abcdefg`ï¼Œè¯·ä»¥å®é™…å¡«å†™çš„æ’ä»¶è®¾ç½®ä¸ºå‡†ã€‚

## Cloudflare Access è®¤è¯

v0.7.0 ç‰ˆæœ¬æ–°å¢å¯¹ [Cloudflare Access](https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/self-hosted-public-app/) è®¤è¯çš„æ”¯æŒã€‚è¿™å…è®¸æ‚¨é€šè¿‡ Cloudflare Tunnel å®‰å…¨åœ°å°† MCP æœåŠ¡æš´éœ²åˆ°äº’è”ç½‘ï¼ŒåŒæ—¶ä½¿ç”¨ Cloudflare Zero Trust è¿›è¡Œèº«ä»½éªŒè¯ã€‚

### ä½¿ç”¨åœºæ™¯

1. **è‡ªæ‰˜ç®¡å…¬å¼€åº”ç”¨**ï¼šé€šè¿‡ Cloudflare Tunnel æš´éœ² MCP æœåŠ¡ï¼Œä½¿ç”¨ Cloudflare Access è¿›è¡Œç”¨æˆ·è®¤è¯
2. **AI ä»£ç†é“¾æ¥åº”ç”¨**ï¼šå…è®¸ AI ä»£ç†ä½¿ç”¨ [Cloudflare Linked Apps OAuth](https://developers.cloudflare.com/cloudflare-one/access-controls/ai-controls/linked-apps/) è®¿é—®æ‚¨çš„ MCP æœåŠ¡

### é…ç½®æ­¥éª¤

1. åœ¨ [Cloudflare Zero Trust æ§åˆ¶å°](https://one.dash.cloudflare.com/) è®¾ç½®è‡ªæ‰˜ç®¡åº”ç”¨
2. åˆ›å»º Cloudflare Tunnel æš´éœ²æ‚¨çš„ MCP æœåŠ¡
3. åœ¨æ’ä»¶è®¾ç½®ä¸­ï¼Œå¯ç”¨ **Cloudflare Access è®¤è¯**
4. è¾“å…¥æ‚¨çš„ **å›¢é˜ŸåŸŸå**ï¼ˆä¾‹å¦‚ï¼š`https://myteam.cloudflareaccess.com`ï¼‰
5. è¾“å…¥æ‚¨çš„ **åº”ç”¨ AUD æ ‡ç­¾**ï¼ˆåœ¨ Access > Applications > [æ‚¨çš„åº”ç”¨] > Overview ä¸­æ‰¾åˆ°ï¼‰
6. ä¿å­˜è®¾ç½®å¹¶é‡å¯ MCP æœåŠ¡

### å·¥ä½œåŸç†

æ’ä»¶ä½¿ç”¨å¤šç§è®¤è¯æ–¹å¼éªŒè¯ä¼ å…¥è¯·æ±‚ï¼š

| æ–¹å¼ | å¤´/ä»¤ç‰Œ | ä½¿ç”¨åœºæ™¯ |
|------|---------|----------|
| Cloudflare Access | `Cf-Access-Jwt-Assertion` å¤´ | é€šè¿‡ Cloudflare Tunnel è®¿é—®çš„ç”¨æˆ· |
| Cloudflare Linked Apps | `Authorization: Bearer <JWT>` | å…·æœ‰ OAuth å§”æ‰˜çš„ AI ä»£ç† |
| æœ¬åœ° Bearer Token | `Authorization: Bearer <hash>` | ç›´æ¥æœ¬åœ°è®¿é—® |

å¯ç”¨ Cloudflare Access åï¼š
- å¸¦æœ‰ `Cf-Access-Jwt-Assertion` å¤´çš„è¯·æ±‚å°†æ ¹æ® Cloudflare çš„ JWKS è¿›è¡ŒéªŒè¯
- çœ‹èµ·æ¥åƒ JWT çš„ Bearer ä»¤ç‰Œä¹Ÿä¼šä½œä¸º Cloudflare OAuth ä»¤ç‰Œè¿›è¡ŒéªŒè¯
- å¦‚æœåŒæ—¶é…ç½®äº† Cloudflare Access å’Œæœ¬åœ°è®¤è¯ï¼Œç³»ç»Ÿä¼šå…ˆå°è¯• Cloudflareï¼Œç„¶åå›é€€åˆ°æœ¬åœ°è®¤è¯

### æ€§èƒ½ä¼˜åŒ–

æ’ä»¶åŒ…å« JWT éªŒè¯ä¼˜åŒ–ï¼š
- æ¯ä¸ªå›¢é˜ŸåŸŸåç¼“å­˜ JWKS å®ä¾‹
- å·²éªŒè¯çš„ä»¤ç‰Œåœ¨è¿‡æœŸå‰ 30 ç§’å†…è¢«ç¼“å­˜
- ä½¿ç”¨ç›¸åŒä»¤ç‰Œçš„é‡å¤è¯·æ±‚è·³è¿‡åŠ å¯†éªŒè¯

## ğŸ™å‚è€ƒ&æ„Ÿè°¢

> éƒ¨åˆ†ä¾èµ–é¡¹åœ¨`package.json`ä¸­åˆ—å‡ºã€‚

| å¼€å‘è€…/é¡¹ç›®                                                         | é¡¹ç›®æè¿°           | å¼•ç”¨æ–¹å¼         |
|---------------------------------------------------------------------|----------------|--------------|
| [thuanpham582002/tabby-mcp-server](https://github.com/thuanpham582002/tabby-mcp-server) | åœ¨ç»ˆç«¯è½¯ä»¶Tabbyä¸­æä¾›MCPæœåŠ¡ï¼› MIT License | MCPæœåŠ¡å®ç°æ–¹å¼ |
| [wilsons](https://ld246.com/article/1756172573626/comment/1756384424179?r=wilsons#comments) / [Frostime](https://ld246.com/article/1739546865001#%E6%80%9D%E6%BA%90-SQL-%E6%9F%A5%E8%AF%A2-System-Prompt) | æç¤ºè¯/ç³»ç»Ÿæç¤ºè¯ CC BY-SA 4.0 | ç³»ç»Ÿæç¤ºè¯ç­‰ï¼Œä½äºé¡¹ç›®çš„`static/`ç›®å½• |
